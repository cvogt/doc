

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Slick TestKit &mdash; Slick 1.0.0-RC1 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0-RC1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Slick 1.0.0-RC1 documentation" href="index.html" />
    <link rel="prev" title="Plain SQL Queries" href="sql.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="sql.html" title="Plain SQL Queries"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Slick 1.0.0-RC1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Slick TestKit</a><ul>
<li><a class="reference internal" href="#scaffolding">Scaffolding</a></li>
<li><a class="reference internal" href="#driver">Driver</a></li>
<li><a class="reference internal" href="#test-harness">Test Harness</a></li>
<li><a class="reference internal" href="#database-configuration">Database Configuration</a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="sql.html"
                        title="previous chapter">Plain SQL Queries</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/testkit.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="slick-testkit">
<h1>Slick TestKit<a class="headerlink" href="#slick-testkit" title="Permalink to this headline">¶</a></h1>
<p>When you write your own database driver for Slick, you need a way to run all
the standard unit tests on it (in addition to any custom tests you may want to
add) to ensure that it works correctly and does not claim to support any
capabilities which are not actually implemented. For this purpose the Slick
unit tests have been factored out into a separate Slick TestKit project.</p>
<p>To get started, you can clone the <a class="reference external" href="https://github.com/slick/slick-testkit-example/tree/1.0.0-RC1">Slick TestKit Example</a> project which
contains a (slightly outdated) version of Slick&#8217;s standard PostgreSQL driver
and all the infrastructure required to build and test it.</p>
<div class="section" id="scaffolding">
<h2>Scaffolding<a class="headerlink" href="#scaffolding" title="Permalink to this headline">¶</a></h2>
<p>Its <tt class="docutils literal"><span class="pre">build.sbt</span></tt> file is straight-forward. Apart from the usual name and
version settings, it adds the dependencies for Slick, the TestKit,
junit-interface, Logback and the PostgreSQL JDBC driver, and it sets some
options for the test runs:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">libraryDependencies</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="s">&quot;com.typesafe&quot;</span> <span class="o">%%</span> <span class="s">&quot;slick&quot;</span> <span class="o">%</span> <span class="s">&quot;1.0.0-SNAPSHOT&quot;</span><span class="o">,</span>
  <span class="s">&quot;com.typesafe&quot;</span> <span class="o">%%</span> <span class="s">&quot;slick-testkit&quot;</span> <span class="o">%</span> <span class="s">&quot;1.0.0-SNAPSHOT&quot;</span> <span class="o">%</span> <span class="s">&quot;test&quot;</span><span class="o">,</span>
  <span class="s">&quot;com.novocode&quot;</span> <span class="o">%</span> <span class="s">&quot;junit-interface&quot;</span> <span class="o">%</span> <span class="s">&quot;0.10-M1&quot;</span> <span class="o">%</span> <span class="s">&quot;test&quot;</span><span class="o">,</span>
  <span class="s">&quot;ch.qos.logback&quot;</span> <span class="o">%</span> <span class="s">&quot;logback-classic&quot;</span> <span class="o">%</span> <span class="s">&quot;0.9.28&quot;</span> <span class="o">%</span> <span class="s">&quot;test&quot;</span><span class="o">,</span>
  <span class="s">&quot;postgresql&quot;</span> <span class="o">%</span> <span class="s">&quot;postgresql&quot;</span> <span class="o">%</span> <span class="s">&quot;9.1-901.jdbc4&quot;</span> <span class="o">%</span> <span class="s">&quot;test&quot;</span>
<span class="o">)</span>

<span class="n">testOptions</span> <span class="o">+=</span> <span class="nc">Tests</span><span class="o">.</span><span class="nc">Argument</span><span class="o">(</span><span class="nc">TestFrameworks</span><span class="o">.</span><span class="nc">JUnit</span><span class="o">,</span> <span class="s">&quot;-q&quot;</span><span class="o">,</span> <span class="s">&quot;-v&quot;</span><span class="o">,</span> <span class="s">&quot;-s&quot;</span><span class="o">,</span> <span class="s">&quot;-a&quot;</span><span class="o">)</span>

<span class="n">parallelExecution</span> <span class="n">in</span> <span class="nc">Test</span> <span class="o">:=</span> <span class="kc">false</span>

<span class="n">logBuffered</span> <span class="o">:=</span> <span class="kc">false</span>
</pre></div>
</div>
<p>There is a copy of Slick&#8217;s logback configuration in
<tt class="docutils literal"><span class="pre">src/test/resources/logback-test.xml</span></tt> but you can swap out the logging
framework if you prefer a different one.</p>
</div>
<div class="section" id="driver">
<h2>Driver<a class="headerlink" href="#driver" title="Permalink to this headline">¶</a></h2>
<p>The actual driver implementation can be found under <tt class="docutils literal"><span class="pre">src/main/scala</span></tt>.</p>
</div>
<div class="section" id="test-harness">
<h2>Test Harness<a class="headerlink" href="#test-harness" title="Permalink to this headline">¶</a></h2>
<p>In order to run the TestKit tests, you need to add a class that extends
<tt class="docutils literal"><span class="pre">DriverTest</span></tt>, plus an implementation of <tt class="docutils literal"><span class="pre">TestDB</span></tt> which tells the TestKit
how to connect to a test database, get a list of tables, clean up between
tests, etc.</p>
<p>In the case of the PostgreSQL test harness (in
<tt class="docutils literal"><span class="pre">src/test/scala/scala/slick/driver/test/MyPostgresTest.scala</span></tt>) most of the
default implementations can be used out of the box:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="nd">@RunWith</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">Testkit</span><span class="o">])</span>
<span class="k">class</span> <span class="nc">MyPostgresTest</span> <span class="k">extends</span> <span class="nc">DriverTest</span><span class="o">(</span><span class="nc">MyPostgresTest</span><span class="o">.</span><span class="n">tdb</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">MyPostgresTest</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">tdb</span><span class="o">(</span><span class="n">cname</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ExternalTestDB</span><span class="o">(</span><span class="s">&quot;mypostgres&quot;</span><span class="o">,</span> <span class="nc">MyPostgresDriver</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">override</span> <span class="k">def</span> <span class="n">getLocalTables</span><span class="o">(</span><span class="k">implicit</span> <span class="n">session</span><span class="k">:</span> <span class="kt">Session</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">tables</span> <span class="k">=</span> <span class="nc">ResultSetInvoker</span><span class="o">[(</span><span class="kt">String</span>,<span class="kt">String</span>,<span class="kt">String</span>, <span class="kt">String</span><span class="o">)](</span><span class="k">_</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">getMetaData</span><span class="o">().</span><span class="n">getTables</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;public&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">))</span>
      <span class="n">tables</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_4</span><span class="o">.</span><span class="n">toUpperCase</span> <span class="o">==</span> <span class="s">&quot;TABLE&quot;</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_3</span><span class="o">).</span><span class="n">sorted</span>
    <span class="o">}</span>
    <span class="k">override</span> <span class="k">def</span> <span class="n">getLocalSequences</span><span class="o">(</span><span class="k">implicit</span> <span class="n">session</span><span class="k">:</span> <span class="kt">Session</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">tables</span> <span class="k">=</span> <span class="nc">ResultSetInvoker</span><span class="o">[(</span><span class="kt">String</span>,<span class="kt">String</span>,<span class="kt">String</span>, <span class="kt">String</span><span class="o">)](</span><span class="k">_</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">getMetaData</span><span class="o">().</span><span class="n">getTables</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;public&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">))</span>
      <span class="n">tables</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_4</span><span class="o">.</span><span class="n">toUpperCase</span> <span class="o">==</span> <span class="s">&quot;SEQUENCE&quot;</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_3</span><span class="o">).</span><span class="n">sorted</span>
    <span class="o">}</span>
    <span class="k">override</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">capabilities</span> <span class="k">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">+</span> <span class="nc">TestDB</span><span class="o">.</span><span class="n">plainSql</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="database-configuration">
<h2>Database Configuration<a class="headerlink" href="#database-configuration" title="Permalink to this headline">¶</a></h2>
<p>Since the PostgreSQL test harness is based on <tt class="docutils literal"><span class="pre">ExternalTestDB</span></tt>, it needs to
be configured in <tt class="docutils literal"><span class="pre">test-dbs/databases.properties</span></tt>:</p>
<div class="highlight-scala"><pre># PostgreSQL quick setup:
# - Install PostgreSQL server with default options
# - Change password in mypostgres.password
# - Set mypostgres.enabled = true
mypostgres.enabled = false
mypostgres.url = jdbc:postgresql:[DB]
mypostgres.user = postgres
mypostgres.password = secret
mypostgres.adminDB = postgres
mypostgres.testDB = slick-test
mypostgres.create = CREATE TABLESPACE slick_test LOCATION '[DBPATH]'; CREATE DATABASE "[DB]" TEMPLATE = template0 TABLESPACE slick_test
mypostgres.drop = DROP DATABASE IF EXISTS "[DB]"; DROP TABLESPACE IF EXISTS slick_test
mypostgres.driver = org.postgresql.Driver</pre>
</div>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>Running <tt class="docutils literal"><span class="pre">sbt</span> <span class="pre">test</span></tt> discovers <tt class="docutils literal"><span class="pre">MyPostgresTest</span></tt> and runs it with TestKit&#8217;s
JUnit runner. This in turn causes the database to be set up through the test
harness and all tests which are applicable for the driver (as determined by
the <tt class="docutils literal"><span class="pre">capabilities</span></tt> setting in the test harness) to be run.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="sql.html" title="Plain SQL Queries"
             >previous</a> |</li>
        <li><a href="index.html">Slick 1.0.0-RC1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2012 Typesafe, Inc..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>